local keywordHandler = KeywordHandler:new()
local npcHandler = NpcHandler:new(keywordHandler)
NpcSystem.parseParameters(npcHandler)
local talkState = {}

function onCreatureAppear(cid)              npcHandler:onCreatureAppear(cid)            end
function onCreatureDisappear(cid)           npcHandler:onCreatureDisappear(cid)         end
function onCreatureSay(cid, type, msg)      npcHandler:onCreatureSay(cid, type, msg)    end
function onThink()                          npcHandler:onThink()                        end
function onPlayerEndTrade(cid)              npcHandler:onPlayerEndTrade(cid)            end
function onPlayerCloseChannel(cid)          npcHandler:onPlayerCloseChannel(cid)        end

function creatureSayCallback(cid, type, msg)
    if not npcHandler:isFocused(cid) then
        return false
	end
	
	if msgcontains(msg, "time") then
		local time = getTibiaTime()
	    npcHandler:say("Agora são ".. time.hours ..":".. time.minutes ..".", cid)
		npcHandler.topic[cid] = 0
	end
	return true
end

local shopModule = ShopModule:new()
npcHandler:addModule(shopModule)

shopModule:addBuyableItem({'red cushioned chair'}, 3901, 400, 'red cushioned chair')
shopModule:addBuyableItem({'green cushioned chair'}, 3902, 400, 'green cushioned chair')
shopModule:addBuyableItem({'wooden chair'}, 3903, 150, 'wooden chair')
shopModule:addBuyableItem({'rocking chair'}, 3904, 250, 'rocking chair')
shopModule:addBuyableItem({'sofa chair'}, 3905, 550, 'sofa chair')
shopModule:addBuyableItem({'tusk chair'}, 3906, 250, 'tusk chair')
shopModule:addBuyableItem({'ivory chair'}, 3907, 250, 'ivory chair')
shopModule:addBuyableItem({'small table'}, 3908, 200, 'small table')
shopModule:addBuyableItem({'small round table'}, 3909, 250, 'small round table')
shopModule:addBuyableItem({'big table'}, 3911, 300, 'big table')
shopModule:addBuyableItem({'stone table'}, 3912, 300, 'stone table')
shopModule:addBuyableItem({'tusk table'}, 3913, 250, 'tusk table')
shopModule:addBuyableItem({'bamboo table'}, 3914, 250, 'bamboo table')
shopModule:addBuyableItem({'drawers'}, 3915, 180, 'drawers')
shopModule:addBuyableItem({'dresser'}, 3916, 250, 'dresser')
shopModule:addBuyableItem({'locker'}, 3917, 300, 'locker')
shopModule:addBuyableItem({'trough'}, 3918, 70, 'trough')
shopModule:addBuyableItem({'barrel'}, 3919, 120, 'barrel')
shopModule:addBuyableItem({'large trunk'}, 3920, 120, 'large trunk')
shopModule:addBuyableItem({'bamboo drawer'}, 3921, 200, 'bamboo drawer')
shopModule:addBuyableItem({'birdcage'}, 3922, 500, 'birdcage')
shopModule:addBuyableItem({'globe'}, 3923, 500, 'globe')
shopModule:addBuyableItem({'table lamp'}, 3924, 350, 'table lamp')
shopModule:addBuyableItem({'telescope'}, 3925, 700, 'telescope')
shopModule:addBuyableItem({'rocking horse'}, 3926, 300, 'rocking horse')
shopModule:addBuyableItem({'pendulum clock'}, 3927, 750, 'pendulum clock')
shopModule:addBuyableItem({'knight statue'}, 3928, 500, 'knight statue')
shopModule:addBuyableItem({'minotaur statue'}, 3929, 500, 'minotaur statue')
shopModule:addBuyableItem({'goblin statue'}, 3930, 500, 'goblin statue')
shopModule:addBuyableItem({'large amphora'}, 3931, 500, 'large amphora')
shopModule:addBuyableItem({'coal basin'}, 3932, 250, 'coal basin')
shopModule:addBuyableItem({'piano'}, 3933, 2000, 'piano')
shopModule:addBuyableItem({'harp'}, 3934, 500, 'harp')
shopModule:addBuyableItem({'small trunk'}, 3935, 200, 'small trunk')
shopModule:addBuyableItem({'thick trunk'}, 3936, 200, 'thick trunk')
shopModule:addBuyableItem({'indoor plant'}, 3937, 80, 'indoor plant')
shopModule:addBuyableItem({'ornamented stone table'}, 3938, 5000, 'ornamented stone table')
shopModule:addBuyableItem({'monkey statue see'}, 5086, 650, 'monkey statue see')
shopModule:addBuyableItem({'monkey statue hear'}, 5087, 650, 'monkey statue hear')
shopModule:addBuyableItem({'monkey statue speak'}, 5088, 650, 'monkey statue speak')
shopModule:addBuyableItem({'armor rack'}, 6114, 900, 'armor rack')
shopModule:addBuyableItem({'weapon rack'}, 6115, 900, 'weapon rack')
shopModule:addBuyableItem({'oven'}, 6372, 800, 'oven')
shopModule:addBuyableItem({'bookcase'}, 6373, 700, 'bookcase')
shopModule:addBuyableItem({'chimney'}, 8692, 2000, 'chimney')
shopModule:addBuyableItem({'crystal table'}, 9974, 1500, 'crystal table')
shopModule:addBuyableItem({'lizard weapon rack'}, 11126, 5000, 'lizard weapon rack')
shopModule:addBuyableItem({'dragon statue'}, 11133, 10000, 'dragon statue')
shopModule:addBuyableItem({'dragon throne'}, 11205, 12000, 'dragon throne')
shopModule:addBuyableItem({'dragon tapestry'}, 11264, 800, 'dragon tapestry')
shopModule:addBuyableItem({'black skull'}, 9969, 5000, 'black skull')
shopModule:addBuyableItem({'amphora'}, 2023, 40, 0, 'amphora')
shopModule:addBuyableItem({'blue pillow'}, 1686, 250, 'blue pillow')
shopModule:addBuyableItem({'blue tapestry'}, 1872, 250, 'blue tapestry')
shopModule:addBuyableItem({'box'}, 1738, 100, 'box')
shopModule:addBuyableItem({'chest'}, 1740, 100, 'chest')
shopModule:addBuyableItem({'crate'}, 1739, 100, 'crate')
shopModule:addBuyableItem({'cuckoo clock'}, 1877, 400, 'cuckoo clock')
shopModule:addBuyableItem({'empty goldfish bowl'}, 5928, 500, 'empty goldfish bowl')
shopModule:addBuyableItem({'flower bowl'}, 2102, 60, 'flower bowl')
shopModule:addBuyableItem({'god flowers'}, 2100, 50, 'god flowers')
shopModule:addBuyableItem({'green pillow'}, 1688, 250, 'green pillow')
shopModule:addBuyableItem({'green tapestry'}, 1860, 250, 'green tapestry')
shopModule:addBuyableItem({'heart pillow'}, 1685, 300, 'heart pillow')
shopModule:addBuyableItem({'honey flower'}, 2103, 50, 'honey flower')
shopModule:addBuyableItem({'orange tapestry'}, 1866, 250, 'orange tapestry')
shopModule:addBuyableItem({'picture landscape'}, 1852, 500, 'picture landscape')
shopModule:addBuyableItem({'picture still life'}, 1853, 500, 'picture still life')
shopModule:addBuyableItem({'picture portrait'}, 1854, 500, 'picture portrait')
shopModule:addBuyableItem({'potted flower'}, 2104, 500, 'potted flower')
shopModule:addBuyableItem({'purple tapestry'}, 1857, 250, 'purple tapestry')
shopModule:addBuyableItem({'red pillow'}, 1687, 250, 'red pillow')
shopModule:addBuyableItem({'red tapestry'}, 1869, 250, 'red tapestry')
shopModule:addBuyableItem({'round blue pillow'}, 1690, 250, 'round blue pillow')
shopModule:addBuyableItem({'round purple pillow'}, 1692, 250, 'round purple pillow')
shopModule:addBuyableItem({'round red pillow'}, 1691, 250, 'round red pillow')
shopModule:addBuyableItem({'round turquoise pillow'}, 1693, 250, 'round turquoise pillow')
shopModule:addBuyableItem({'small blue pillow'}, 1681, 200, 'small blue pillow')
shopModule:addBuyableItem({'small green pillow'}, 1679, 200, 'small green pillow')
shopModule:addBuyableItem({'small ice statue fish'}, 7447, 500, 'small ice statue fish')
shopModule:addBuyableItem({'small ice statue bird'}, 7448, 500, 'small ice statue bird')
shopModule:addBuyableItem({'small orange pillow'}, 1682, 200, 'small orange pillow')
shopModule:addBuyableItem({'small purple pillow'}, 1678, 200, 'small purple pillow')
shopModule:addBuyableItem({'small red pillow'}, 1680, 200, 'small red pillow')
shopModule:addBuyableItem({'small turquoise pillow'}, 1683, 200, 'small turquoise pillow')
shopModule:addBuyableItem({'small white pillow'}, 1684, 200, 'small white pillow')
shopModule:addBuyableItem({'trophy stand'}, 7936, 500, 'trophy stand')
shopModule:addBuyableItem({'vase'}, 7936, 30, 0, 'vase')
shopModule:addBuyableItem({'edged mirror'}, 1848, 400, 'edged mirror')
shopModule:addBuyableItem({'wall mirror oval'}, 1851, 400, 'wall mirror oval')
shopModule:addBuyableItem({'wall mirror round'}, 1845, 400, 'wall mirror round')
shopModule:addBuyableItem({'water pipe'}, 2093, 400, 'water pipe')
shopModule:addBuyableItem({'white tapestry'}, 1880, 250, 'white tapestry')
shopModule:addBuyableItem({'yellow pillow'}, 1689, 250, 'yellow pillow')
shopModule:addBuyableItem({'yellow tapestry'}, 1863, 250, 'yellow tapestry')
shopModule:addBuyableItem({'crystal pedestal'}, 9976, 25000, 'crystal pedestal')
shopModule:addBuyableItem({'dracoyle statue'}, 9949, 40000, 'dracoyle statue')
shopModule:addBuyableItem({'elven vase'}, 2011, 850, 0, 'elven vase')
shopModule:addBuyableItem({'silky tapestry'}, 9959, 1000, 'silky tapestry')
shopModule:addBuyableItem({'standing mirror'}, 12876, 400, 'standing mirror')
shopModule:addBuyableItem({'velvet tapestry'}, 9837, 1000, 'velvet tapestry')
shopModule:addBuyableItem({'water pipe deluxe'}, 2099, 800, 'water pipe deluxe')
shopModule:addBuyableItem({'crystal ball'}, 2192, 500, 'crystal ball')
shopModule:addBuyableItem({'blue bed'}, 7904, 50000, 'blue bed')
shopModule:addBuyableItem({'green bed'}, 7905, 85000, 'green bed')
shopModule:addBuyableItem({'red bed'}, 7906, 85000, 'red bed')
shopModule:addBuyableItem({'yellow bed'}, 7907, 85000, 'yellow bed')

npcHandler:setMessage(MESSAGE_GREET, "Hiho, Bezil ao seu serviço, |PLAYERNAME|. Nós vendemos equipamentos de todos os tipos.")
npcHandler:setMessage(MESSAGE_WALKAWAY, "Volte logo!")
npcHandler:setMessage(MESSAGE_FAREWELL, "Volte logo!") 
npcHandler:setMessage(MESSAGE_SENDTRADE, "Não, desculpe, oi? negociar? Ok!")
 
keywordHandler:addKeyword({"dwarfs"}, StdModule.say, {npcHandler = npcHandler, text = "Meu povo é tão velho e robusto quanto a pedra da montanha em que vivemos."})
keywordHandler:addKeyword({"equipment"}, StdModule.say, {npcHandler = npcHandler, text = "Como você pode ver, nós oferecemos bastante, como tochas, pás e similares. Fale {trade} para dar uma olhada."})
keywordHandler:addKeyword({"job"}, StdModule.say, {npcHandler = npcHandler, text = "Eu vendo equipamentos de todo tipo. Existe alguma coisa que você precisa?"})
keywordHandler:addKeyword({"name"}, StdModule.say, {npcHandler = npcHandler, text = "Eu sou o Bezil Coinbiter. Eu vendo coisas, sabe?"})
keywordHandler:addKeyword({"nezil"}, StdModule.say, {npcHandler = npcHandler, text = "Ele é 'meu irmão'."})

npcHandler:setCallback(CALLBACK_MESSAGE_DEFAULT, creatureSayCallback)
npcHandler:addModule(FocusModule:new())